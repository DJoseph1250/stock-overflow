
<% if current_user.following? %>
  <div class="container">
    <div class="row">
      <div class="col col-sm-offset-2 col-sm-8">
        <div id="orders_chart" class="orders-chart" style="width: 100%; height: 400px;"></div>

        <script type="text/javascript" charset="utf-8">
        $(function () {
          new Highcharts.StockChart({
            chart: { renderTo: 'orders_chart' },
            rangeSelector: {
              selected: 4
            },
            <% if @stock %>
              title: { text: "<%= @stock.company %>" },
            <% else %>
              title: { text: "Stock Trends" },
            <% end %>
            xAxis: { 
              type: 'datetime'
            },
            yAxis: {
              title: { text: 'Stock Price'}
            },
            series: <%= raw @series.to_json %>
          });
        });
        </script>
          <div class="row">
            <div class="col col-sm-12">
              <table class="table">
                <thead>
                  <tr>
                    <td></td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><strong><%= link_to stock.symbol, "stocks/#{stock.symbol}" %></strong></td>
                    <% end %>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Previous Close</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= number_to_currency(stock.quote.previous_close) %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>PE Ratio</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= stock.quote.pe_ratio %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>EPS</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= number_to_percentage(stock.quote.earnings_share) %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>Volume</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= stock.quote.volume.to_i %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>Market Cap</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= number_to_currency(stock.quote.market_capitalization) %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>Dividend Yield</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= number_to_percentage(stock.quote.dividend_yield, precision: 2) || 'N/A' %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>Dividend Date</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td><%= stock.quote.ex_dividend_date || 'N/A' %></td>
                    <% end %>
                  </tr>
                  <tr>
                    <td>Sentiment</td>
                    <% current_user.favorite_stocks.each do |stock| %>
                      <td>
                        <div class="progress">
                          <div class="progress-bar progress-bar-success" role="progressbar" style="width: <%= stock.percentage[:positive] %>%"></div>
                          <div class="progress-bar progress-bar-danger" role="progressbar" style="width: <%= stock.percentage[:negative] %>%"></div>
                        </div>
                      </td>
                    <% end %>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <%= render 'follow_stocks_prompt' %>
<% end %>

<div id="feed" class="feed">
  <div role="tabpanel">
    <!-- Nav tabs -->
    <div class="nav-tab-holder">
      <ul class="nav nav-justified nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#chat" aria-controls="chat" role="tab" data-toggle="tab">Chat</a></li>
        <li role="presentation"><a href="#tweets" aria-controls="tweets" role="tab" data-toggle="tab">Tweets</a></li>
        <li role="presentation"><a href="#articles" aria-controls="articles" role="tab" data-toggle="tab">Articles</a></li>
        <center><h4 class="alert"> <%= @current_user.name %></h4></center>
      </ul>
      
    </div>

    <!-- Tab panes -->
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="chat">
        <ul>
          <%= render 'globalchat' %>
        </ul>
      </div>
      <div role="tabpanel" class="tab-pane" id="tweets">
        <ul>
            <% if @current_user.favorite_stocks.count >= 1 %>
              <% @current_user.favorite_tweets.flatten.each do |tweet| %>
              <li><%= link_to tweet.text, tweet.url.to_s %></li>
              <% end %>
            <% end %>
        </ul>
      </div>
      <div role="tabpanel" class="tab-pane" id="articles">
        <ul>
          <% if @current_user.favorite_stocks.count >= 1 %>
            <% @current_user.favorite_articles.flatten.each do |article| %>
            <li><%= link_to article["snippet"], article["web_url"] %></li>
              <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>


